{% extends '_layout' %}

{% do craft.app.view.registerCssFile('https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.core.min.css') %}
{% do craft.app.view.registerJsFile('https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/glide.min.js') %}

{% block content %}
  {% set photos = craft.entries()
    .section(entry.title)
    .status('live')
    .orderBy('postDate desc')
    .all()
  %}

  <section aria-labelledby="gallery-title">
    <div class="min-h-screen bg-black py-10 px-4">
      <div class="mx-auto flex max-w-6xl flex-col gap-8 bg-slate-100 px-4 py-8 sm:px-8 sm:py-10">
        <div class="flex items-center justify-between text-xs uppercase tracking-wide text-slate-700">
          <span>Top</span>
          <span class="text-slate-400">[ {{ photos|length ?: 0 }} ]</span>
          <span>Shot</span>
        </div>

        <div class="text-center space-y-3">
          <h1 id="gallery-title" class="text-2xl font-semibold uppercase tracking-[0.3em] text-slate-800">{{ entry.title }}</h1>
          <p class="text-xs uppercase tracking-wide text-slate-500">Glide carousel</p>
        </div>

        {% if photos|length %}
          <div class="glide gallery-glide">
            <div class="glide__track" data-glide-el="track">
              <ul class="glide__slides">
                {% for photo in photos %}
                  {% set img = photo.image.one() %}
                  {% if img %}
                    {% set altText = img.alt ?? photo.title %}
                    {% set transformedUrl = img.getUrl('fit') ?? img.url %}
                    {% set transformedWidth = img.getWidth('fit') ?? img.width ?? null %}
                    {% set transformedHeight = img.getHeight('fit') ?? img.height ?? null %}

                    <li class="glide__slide">
                      <div class="relative mx-auto aspect-[4/5] w-full max-w-md overflow-hidden border border-slate-300 bg-white shadow">
                        <img
                          class="h-full w-full object-cover"
                          src="{{ transformedUrl }}"
                          alt="{{ altText }}"
                          loading="lazy"
                          width="{{ transformedWidth }}"
                          height="{{ transformedHeight }}"
                        >
                      </div>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>

            <div class="mt-4 flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-slate-700" data-glide-el="controls">
              <button class="px-3 py-2 hover:text-brand focus-visible:outline-none focus-visible:ring focus-visible:ring-brand/50" data-glide-dir="<">[ Prev ]</button>
              <button class="px-3 py-2 hover:text-brand focus-visible:outline-none focus-visible:ring focus-visible:ring-brand/50" data-glide-dir=">">[ Next ]</button>
            </div>

            <div class="glide__bullets mt-6 flex flex-wrap justify-center gap-2" data-glide-el="controls[nav]">
              {% for photo in photos %}
                {% set thumb = photo.image.one() %}
                {% if thumb %}
                  {% set thumbUrl = thumb.getUrl('fit') ?? thumb.url %}
                  <button
                    class="glide__bullet group h-16 w-16 overflow-hidden border border-slate-200 bg-white shadow-sm ring-offset-2 transition hover:-translate-y-0.5 focus-visible:outline-none focus-visible:ring focus-visible:ring-brand/50"
                    data-glide-dir="={{ loop.index0 }}"
                    aria-label="Go to slide {{ loop.index }}"
                  >
                    <img class="h-full w-full object-cover transition duration-150 ease-in-out group-[[data-glide-dir]].glide__bullet--active:opacity-100" src="{{ thumbUrl }}" alt="" aria-hidden="true">
                  </button>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="flex flex-col items-center gap-4">
          <span class="text-xs uppercase tracking-wide text-slate-500">[ {{ photos|length > 0 ? 1 : 0 }} ]</span>
          <div class="text-[clamp(2.5rem,9vw,5rem)] font-extrabold lowercase tracking-tight text-slate-900">wildlife</div>
        </div>
      </div>
    </div>
  </section>

  {% js %}
    new Glide('.gallery-glide', {
      type: 'carousel',
      focusAt: 'center',
      perView: 1,
      gap: 24,
      autoplay: 5000,
      hoverpause: true,
      animationDuration: 550,
      breakpoints: {
        1024: { gap: 16 },
        640: { gap: 12 }
      }
    }).mount();
  {% endjs %}
{% endblock %}
